{% extends "auctions/layout.html" %}

{% load humanize %}

{% block body %}
    <h2>{{ listing.title }}</h2><h5></h5>
    <a class="category_link" href="{% url 'categories' listing.category %}"><strong>{{ listing.category }}</strong></a>
    <div>
        {% if user.is_authenticated %}
            <div class="btn-right">
                {% if listing.user_owner_id == request.user %}
                    Manage This Listing |
                    <a href="{% url 'delete_listing' listing=listing.id %}">[Delete]</a> 
                    {% if listing.sold == False %}
                    <a href="{% url 'sold_listing' listing=listing.id %}">[Mark as Sold]</a>
                    {% endif %}
                {% endif %}
                {% if is_in_watchlist == 1 %}
                <a href="{% url 'remove_from_watchlist' listing=listing.id %}">[Remove from Watchlist]</a>
                {% else %}
                <a href="{% url 'add_watchlist' listing=listing.id %}">[Add to Watchlist]</a>
                {% endif %}
            </div>
        {% endif %}
    </div>
    <br>
    <ul>
                <li><img class="listing_image_main" src="{{ listing.photo }}" alt="{{ listing.title }}"></li>
                <li>Published <strong>{{ listing.published_on | naturaltime }}</strong> </li>
                <li>Auctioneer <strong>{{ listing.user_owner_id }}</strong></li>
                <br>
                <li>Starting Bid: ${{ listing.starting_price }}</li>
                
                {% if listing.latest_bid.bid_owner == request.user and listing.sold %}
                <strong>* You won this bid for ${{ listing.latest_bid.bid_amount | intcomma}} *</strong>

                {% elif listing.sold %}
                <li><strong>SOLD for ${{ listing.latest_bid.bid_amount | intcomma}}</strong> to <strong>{{ listing.latest_bid.bid_owner }}</strong></li>
                {% elif listing.latest_bid.bid_amount %}
                <li>Highest Bid: <strong>${{ listing.latest_bid.bid_amount | intcomma }}</strong> placed by <strong>{{ listing.latest_bid.bid_owner }}</strong></li>
                {% else %}    
                <li><strong>Be the first to bid!!!</strong></li>
                {% endif %}



                <br>
                <li><mark><strong>Details: </strong>{{ listing.description }}</mark></li>
                <hr>
                
                <div class="listing_button">
                    {% if user.is_authenticated %}
                        {% if not listing.sold %}
                            <form method="POST" enctype="multipart/form-data" name="place_bid">
                                {% csrf_token %}{{ new_bid.as_p }}
                                <button type="submit" value="Bid">Bid</button>
                            </form>
                        {% else %}
                            ** This item has been SOLD. **
                        {% endif %}
                    {% else %}
                            ** Log In to place a bid **
                    {% endif %}
                </div>
    </ul>

<hr>

    <div>
        <h3>Comments</h3>
        <div>


            <div class="listing_button">
                {% if user.is_authenticated %}
                        <form method="POST" enctype="multipart/form-data" name="place_comment">
                            {% csrf_token %}
                            {{ new_comment.as_p }}
                            <button type="submit" value="Comment">Send</button>
                        </form>
                {% else %}
                        ** Log In to a comment **
                {% endif %}
            </div>
            <br>
            <hr>
        </div>
        <div>
            {% for comment in comments %}
            <strong>{{ comment.comment_owner }} </strong> on {{ comment.published_on }} :
            {{ comment.comment }}<br>

            <hr>
            {% empty %}
            No comments yet.
            {% endfor %}
        </div>
     </div>
    
{% endblock %}